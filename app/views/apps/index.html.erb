<div class="app"> 
  <div class="app-card">
    <h1>Heroku Apps By Type</h1>
    <%= content_tag :p, "App data as of: #{Date.yesterday.to_formatted_s(:long_ordinal)}" %>
    <%= content_tag :p, "#{@app_count} Apps" %>
    <%= content_tag :p, class: 'app-btn' do %>
      <%= link_to "Group by owner", orgs_path, class: 'btn' %>
    <% end %>
    <%= content_tag :p, "API requests remaining at #{@time}: <span class='rate-limit'>#{@rate_limit} out of 2400</span>".html_safe %>
  </div>

  <div class="app-group">
    <% grouped_apps = get_app_groups(@app_list) %>
    <% grouped_apps.each do |type, apps| %>
      <% unless apps.blank? %>
        <%= content_tag :h3, class: "app-title", id: type.downcase do %>
          <span class="app-name"><%= type %></span>
          <span><%= "Group App Count: <span class='counter'>#{@app_count}</span>".html_safe %> | </span>
          <span><%= "Average dynos per app: <span class='counter'>#{average_dynos_per_app(apps)}</span>".html_safe %> | </span>
          <% if version_apps_list.has_key? type.downcase.parameterize %>
            <span class='version'>Master: 
              <span class="version-value">
                <%= get_master_version(type) %>
              </span>
            </span>
            <a href='#' class='version-refresh'><%= image_tag('reload.png', class: 'version-refresh-icon', alt: 'Refresh Versions') %></a>
          <% end %>
        <% end %>
        <ul class="app-list">
          <% apps.each do |app| %>
            <li>
              <span class="app-name">
                <%= link_to app.name, app_path(app)  %>
              </span>
              <%= link_to "Dashboard |", "https://dashboard.heroku.com/apps/#{app.name}/", target: "blank" %>
              <%= link_to "App", "https://#{app.name}.herokuapp.com", target: "blank" %>
              <%= link_to "| Dyno Count: #{dyno_count(app.dynos)}", "https://dashboard.heroku.com/apps/#{app.name}/resources", target: "blank" if app.dynos  %>
              <% if version_apps_list.has_key? type.downcase.parameterize %>
                <span class="version">
                  <span class="version-value">
                    ...
                  </span>
                </span>
              <% end %>
            </li>
          <% end %>
        </ul>
      <% end %>
    <% end %>
  </div>
</div>